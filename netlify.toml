# PFF â€” Root redirect so Netlify builds the web app from web/
# When this repo is connected to Netlify, use base directory "web" so build runs there.

[build]
  base = "web"
  command = "npm run build"
  # Publish path from repo root so deploy finds web/out when run from root
  publish = "web/out"

[build.environment]
  NODE_VERSION = "20.10.0"
  NEXT_TELEMETRY_DISABLED = "1"
  NETLIFY_NEXT_PLUGIN_SKIP = "true"
  NODE_OPTIONS = "--max-old-space-size=4096"

# Functions live in web/netlify/functions (relative to base)
[functions]
  directory = "netlify/functions"
  node_bundler = "esbuild"

# Edge: Sovereign Companion responds from the data center closest to the user
[[edge_functions]]
  function = "sovereign-heartbeat"
  path = "/api/sovereign-edge"

# Rewrite /api/identity-reset to Netlify Function so Reset Identity clears Supabase on live site
[[redirects]]
  from = "/api/identity-reset"
  to = "/.netlify/functions/identity-reset"
  status = 200
  force = true

# Sovereign Companion search: static export has no API routes; serve via Netlify Function so /api/sovereign-recognition works on deploy
[[redirects]]
  from = "/api/sovereign-recognition"
  to = "/.netlify/functions/sovereign-recognition"
  status = 200
  force = true
